<div class="page page-orders">

  <h4 *ngIf="user"><b>{{user.storeName}}</b></h4>

  <input style="width: 100px;" matInput [matDatepicker]="picker" placeholder="" [(ngModel)]="today" (ngModelChange)="todayOrders()">
  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
  <mat-datepicker #picker></mat-datepicker> 

  &nbsp;&nbsp; 주문만 보기 <input  type="checkbox" [(ngModel)]="orderOnly" (ngModelChange)="todayOrders() "/>

  <table class="table table-striped menus" border="0">
    <tbody>    

      <tr *ngIf = "!orders || orders.length === 0">
        <td class="noData" colspan="3">등록된 주문이 없습니다.</td>
      </tr>

      <ng-container *ngFor="let order of orders; let i=index">
        
        <ng-container *ngIf="orderOnly === true && order.status ==='주문'">
            <tr>
                <td colspan="4" style="width:100%">
                  <!-- * 상태 : 선택, 주문, 접수, 계산, 취소 -->
                  <ng-container *ngIf="order.type===0">
                    <b>주문서 : {{order.username}} &nbsp;&nbsp;상태: {{order.status}}</b> <br/>
                    주문번호: {{order._id }} - {{order.orderNo}}<br />  
                      {{ order.createdAt | date: 'yyyy-MM-dd HH:mm' }} <br/>
                  </ng-container>
                  <ng-container *ngIf="order.type===1">
                      <b>주문서 : 비회원&nbsp;&nbsp;상태: {{order.status}}</b> <br/>
                      주문번호: {{order._id }} - {{order.orderNo}}<br />  
                      {{ order.createdAt | date: 'yyyy-MM-dd HH:mm' }} <br/>
                      {{order.phoneno}} 
                  </ng-container>
                </td>
              </tr>
              <tr>
                <th style="width:35%" class="text-center">맛있는 메뉴</th>
                <th style="width:15%" class="text-center">가격</th>
                <th style="width:30%" class="text-center">수량</th>
                <th style="width:20%" class="text-center">금액</th>
              </tr>
              <ng-container *ngFor="let ordermenu of order.ordermenu">
                <tr>            
                  <td>
                      <div *ngIf="ordermenu.classify==='곱배기';then content else other_content"></div>    
                      <ng-template #content>{{ordermenu.name}}(곱)</ng-template>
                      <ng-template #other_content>{{ordermenu.name}}</ng-template>
                  </td>
                  <td align="right">{{ordermenu.price | number}}</td>
                  <td align="right"> {{ordermenu.number | number}}</td>
                  <td align="right"> {{ordermenu.sum | number}}</td>
                </tr>
              </ng-container>
              <tr>
                <td colspan="4" align="right">
                  <b>합계: {{ getTotal(order) | number }}</b>
                </td>
              </tr>
              <tr>
                <td colspan="4" align="right">
                  테이블: <input style="width: 48px; height: 30px; padding-bottom: 6px; text-align: center" [(ngModel)]="order.tableNo" type="text"/>
                  <button class="btn btn-default btn-sm" (click)="setTable(order)">지정</button>&nbsp;
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  접수문자 <input  type="checkbox" [(ngModel)]="orderAccept"/>
                  차림문자 <input  type="checkbox" [(ngModel)]="orderReady"/>&nbsp;
                  <button type="button" class="btn btn-warning btn-sm" (click)="confirmOrder(order, '주문')">주문</button>
                  <button type="button" class="btn btn-success btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '접수')">접수</button>
                  <button type="button" class="btn btn-info btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '차림')">차림</button>
                  <button type="button" class="btn btn-primary btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '계산')">계산</button>
                  <button type="button" class="btn btn-danger btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '취소')">취소</button>
                </td>
              </tr>
        </ng-container>
        <ng-container *ngIf="orderOnly === false">        
          <tr>
            <td colspan="4" style="width:100%">
                <ng-container *ngIf="order.type===0">
                <b>주문서 : {{order.username}} &nbsp;&nbsp;상태: {{order.status}}</b> <br/>
                주문번호: {{order._id }} - {{order.orderNo}}<br />  
                  {{ order.createdAt | date: 'yyyy-MM-dd HH:mm' }} <br/>
                  <!-- * 상태 : 선택, 주문, 접수, 계산, 취소 -->
                </ng-container>
                <ng-container *ngIf="order.type===1">
                    <b>주문서 : 비회원&nbsp;&nbsp;상태: {{order.status}}</b> <br/>
                    주문번호: {{order._id }} - {{order.orderNo}}<br />  
                    {{ order.createdAt | date: 'yyyy-MM-dd HH:mm' }} <br/>
                    {{order.phoneno}} 
                </ng-container>
            </td>
          </tr>
          <tr>
            <th style="width:35%" class="text-center">맛있는 메뉴</th>
            <th style="width:15%" class="text-center">가격</th>
            <th style="width:30%" class="text-center">수량</th>
            <th style="width:20%" class="text-center">금액</th>
          </tr>
          <ng-container *ngFor="let ordermenu of order.ordermenu">
            <tr>            
              <td>
                  <div *ngIf="ordermenu.classify==='곱배기';then content else other_content"></div>    
                  <ng-template #content>{{ordermenu.name}}(곱)</ng-template>
                  <ng-template #other_content>{{ordermenu.name}}</ng-template>
              </td>
              <td align="right">{{ordermenu.price | number}}</td>
              <td align="right"> {{ordermenu.number | number}}</td>
              <td align="right"> {{ordermenu.sum | number}}</td>
            </tr>
          </ng-container>
          <tr>
            <td colspan="4" align="right">
              <b>합계: {{ getTotal(order) | number }}</b>
            </td>
          </tr>
          <tr>
            <td colspan="4" align="right">
              테이블 : <input style="width: 48px; height: 30px; padding-bottom: 6px; text-align: center" [(ngModel)]="order.tableNo" type="text"/>              
              <button class="btn btn-default btn-sm" (click)="setTable(order)">지정</button>&nbsp;
              &nbsp;&nbsp;&nbsp;&nbsp;
              접수문자 <input  type="checkbox" [(ngModel)]="orderAccept"/>
                  차림문자 <input  type="checkbox" [(ngModel)]="orderReady"/>&nbsp;
              <button type="button" class="btn btn-warning btn-sm" (click)="confirmOrder(order, '주문')">주문</button>
              <button type="button" class="btn btn-success btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '접수')">접수</button>
              <button type="button" class="btn btn-info btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '차림')">차림</button>
              <button type="button" class="btn btn-primary btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '계산')">계산</button>
              <button type="button" class="btn btn-danger btn-sm" style="margin-left: 3px" (click)="confirmOrder(order, '취소')">취소</button>
            </td>
          </tr>
        </ng-container> 
      </ng-container>
    </tbody>
  </table>
</div>
